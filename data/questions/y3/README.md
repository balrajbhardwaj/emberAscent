# Year 3 Questions Directory

This directory contains Year 3 question JSON files generated by Claude AI.

## Expected Structure

Place all Y3 JSON files in this directory:

```
data/questions/y3/
├── english-vocabulary-1000.json
├── english-comprehension-800.json
├── english-grammar-700.json
├── mathematics-arithmetic-1200.json
├── mathematics-geometry-600.json
├── mathematics-measurement-500.json
├── statistics.json (200 questions)
└── ... (13 files total, ~10,000 questions)
```

## JSON Format

Each file should contain an array of questions in this format:

```json
[
  {
    "id": "ENG-VOC-syno-F-Y3-00001",
    "subject": "English",
    "topic": "Vocabulary",
    "subtopic": "Synonyms",
    "question_text": "Which word means the same as HAPPY?",
    "question_type": "synonym",
    "options": {
      "a": "sad",
      "b": "joyful",
      "c": "angry",
      "d": "tired",
      "e": "hungry"
    },
    "correct_answer": "b",
    "explanation": "HAPPY means feeling joy or pleasure. JOYFUL has the same meaning - feeling great happiness.",
    "difficulty": "Foundation",
    "year": "Year 3",
    "curriculum_reference": "KS2 English Y3",
    "exam_board": "Generic"
  }
]
```

## Field Descriptions

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `id` | string | ✓ | Unique identifier (used as `external_id` for deduplication) |
| `subject` | string | ✓ | "English" or "Mathematics" (auto-converted to lowercase) |
| `topic` | string | ✓ | Main topic area |
| `subtopic` | string | | Specific subtopic |
| `question_text` | string | ✓ | The actual question |
| `question_type` | string | | Type of question (e.g., "synonym", "arithmetic") |
| `options` | object | ✓ | Answer choices: `{a, b, c, d, e}` format |
| `correct_answer` | string | ✓ | Correct option letter: "a", "b", "c", "d", or "e" |
| `explanation` | string | ✓ | Plain text explanation (auto-converted to JSONB) |
| `difficulty` | string | ✓ | "Foundation", "Standard", or "Challenge" |
| `year` | string | ✓ | "Year 3" |
| `curriculum_reference` | string | | UK curriculum reference |
| `exam_board` | string | | "Generic", "GL", "CEM", etc. |

## Import Process

The import script will:

1. **Transform data format:**
   - Subject: "English" → "english"
   - Difficulty: "Foundation" → "foundation"
   - Year: "Year 3" → 3
   - Options: `{a,b,c,d,e}` → `[{id:"A", text:"..."}, ...]`
   - Explanation: string → `{step_by_step, visual, worked_example}`

2. **Use external_id for deduplication:**
   - `id` field becomes `external_id` in database
   - Upserts prevent duplicates on re-import

3. **Apply default values:**
   - `created_by`: System profile (EDLAscent Vault - C)
   - `ember_score`: 66 (default for verified imports)
   - `exam_board`: "generic" (if not specified)
   - `is_published`: true

4. **Process in batches:**
   - 50 questions per batch to avoid timeouts
   - Progress updates during import

## Running the Import

```bash
# Make sure Y3 JSON files are in this directory first
npx tsx scripts/import-y3-questions.ts
```

## Verification Queries

After import, run these in Supabase SQL Editor:

```sql
-- Count Y3 questions by subject and difficulty
SELECT 
  subject, 
  difficulty, 
  COUNT(*) as count
FROM questions
WHERE year_group = 3
GROUP BY subject, difficulty
ORDER BY subject, difficulty;

-- Check sample questions
SELECT 
  external_id,
  subject,
  topic,
  difficulty,
  question_text
FROM questions
WHERE year_group = 3
LIMIT 10;

-- Calculate ember_scores
SELECT * FROM update_all_ember_scores();
```

## Notes

- Import is **idempotent** - safe to re-run (upserts on `external_id`)
- System profile (`a0000000-0000-0000-0000-000000000001`) must exist (created by migration 017)
- Requires `SUPABASE_SERVICE_ROLE_KEY` in `.env.local`
