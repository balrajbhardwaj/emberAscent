# Error Reporting System - Implementation Guide\n\n## Overview\n\nThe error reporting system allows users to report issues with questions during practice sessions. This helps maintain question quality and provides feedback for continuous improvement.\n\n## Components Created\n\n### 1. `ReportButton.tsx`\n- **Purpose**: Small, unobtrusive button that triggers the report modal\n- **Usage**: Add to any question component\n- **Props**:\n  - `questionId`: ID of the question to report\n  - `questionText`: Text of the question for preview\n  - `className`: Optional additional CSS classes\n\n```tsx\nimport { ReportButton } from \"@/components/practice/ReportButton\"\n\n<ReportButton \n  questionId=\"question-123\"\n  questionText=\"What is 2 + 2?\"\n  className=\"ml-4\" \n/>\n```\n\n### 2. `ReportModal.tsx`\n- **Purpose**: Modal form for submitting reports\n- **Features**:\n  - Question preview\n  - Report type selection (4 options)\n  - Optional description field\n  - Form validation\n  - Success/error handling\n  - Thank you message after submission\n\n### 3. API Route: `/api/reports`\n- **Purpose**: Handles report submission to database\n- **Features**:\n  - User authentication required\n  - Rate limiting (max 10 reports per day)\n  - Duplicate prevention (24-hour window)\n  - Question existence validation\n  - Error report record creation\n\n### 4. Admin Page: `/admin/reports` (Future)\n- **Purpose**: Administrative interface for reviewing reports\n- **Status**: Placeholder implementation\n- **Features** (planned):\n  - List pending reports\n  - Mark as reviewed/fixed/dismissed\n  - Admin notes\n  - Link to question editing\n\n## Database Schema\n\nThe system uses the existing `error_reports` table:\n\n```sql\nCREATE TABLE error_reports (\n  id UUID PRIMARY KEY,\n  question_id UUID REFERENCES questions(id),\n  reported_by UUID REFERENCES auth.users(id),\n  report_type report_type_enum,\n  description TEXT,\n  status report_status_enum DEFAULT 'pending',\n  reviewed_by UUID,\n  admin_notes TEXT,\n  created_at TIMESTAMP DEFAULT NOW(),\n  updated_at TIMESTAMP DEFAULT NOW()\n);\n```\n\n## Report Types\n\n1. **\"incorrect_answer\"** - Answer seems wrong\n2. **\"unclear\"** - Question is unclear/ambiguous\n3. **\"typo\"** - Spelling/grammar error\n4. **\"other\"** - Other issues\n\n## Integration Examples\n\n### In Practice Questions\n\n```tsx\n// Add to existing question components\nimport { ReportButton } from \"@/components/practice/ReportButton\"\n\nfunction QuestionCard({ question }) {\n  return (\n    <div className=\"question-container\">\n      <div className=\"question-header\">\n        <h3>Question {question.number}</h3>\n        <ReportButton \n          questionId={question.id}\n          questionText={question.text}\n        />\n      </div>\n      {/* Rest of question component */}\n    </div>\n  )\n}\n```\n\n### In Question Review\n\n```tsx\n// Add to session review components\nfunction QuestionReview({ question }) {\n  return (\n    <div className=\"review-item\">\n      {/* Question content */}\n      <div className=\"review-actions\">\n        <ReportButton \n          questionId={question.id}\n          questionText={question.text}\n          className=\"text-xs\" // Smaller for review context\n        />\n      </div>\n    </div>\n  )\n}\n```\n\n## User Experience Flow\n\n1. **Discovery**: User encounters issue during practice\n2. **Reporting**: Clicks subtle \"Report Issue\" button\n3. **Modal Opens**: Question preview + report type selection\n4. **Submission**: User selects type, optionally adds description\n5. **Confirmation**: Success message with thank you\n6. **Continuation**: Modal closes, user continues practice\n\n## Rate Limiting & Validation\n\n### Client-Side Validation\n- Report type selection required\n- Description optional but encouraged\n- Form disabled during submission\n\n### Server-Side Protection\n- Authentication required\n- Max 10 reports per user per day\n- No duplicate reports within 24 hours\n- Question existence verification\n\n## Error Handling\n\n### API Responses\n\n```json\n// Success\n{\n  \"success\": true,\n  \"message\": \"Report submitted successfully\",\n  \"reportId\": \"uuid\"\n}\n\n// Rate limit exceeded\n{\n  \"error\": \"Daily report limit reached. Please try again tomorrow.\"\n}\n\n// Duplicate report\n{\n  \"error\": \"You've already reported an issue with this question recently.\"\n}\n```\n\n### User Feedback\n- Toast notifications for errors\n- Success state in modal\n- Clear error messages\n- Graceful degradation\n\n## Future Enhancements\n\n### Admin Interface\n- View all pending reports\n- Filter by report type/status\n- Bulk actions (approve/dismiss)\n- Question editing integration\n- Report analytics and trends\n\n### Advanced Features\n- Email notifications for admins\n- Automatic question flagging\n- User reputation system\n- Report resolution tracking\n- Question improvement suggestions\n\n## Security Considerations\n\n1. **Authentication**: All reports require valid user session\n2. **Rate Limiting**: Prevents spam and abuse\n3. **Input Validation**: Server-side validation for all inputs\n4. **SQL Injection**: Uses parameterized queries\n5. **XSS Prevention**: Proper input sanitization\n\n## Monitoring & Analytics\n\n### Key Metrics to Track\n- Reports per day/week\n- Report types distribution\n- Resolution time\n- User satisfaction\n- Question improvement rate\n\n### Database Queries\n\n```sql\n-- Daily report count\nSELECT COUNT(*) FROM error_reports \nWHERE created_at >= CURRENT_DATE;\n\n-- Report types breakdown\nSELECT report_type, COUNT(*) \nFROM error_reports \nGROUP BY report_type;\n\n-- Pending reports\nSELECT * FROM error_reports \nWHERE status = 'pending'\nORDER BY created_at DESC;\n```\n\n## Testing\n\n### Manual Testing Checklist\n- [ ] Report button appears correctly\n- [ ] Modal opens with question preview\n- [ ] All report types selectable\n- [ ] Description field works\n- [ ] Form validation works\n- [ ] Success message displays\n- [ ] Rate limiting works\n- [ ] Duplicate prevention works\n- [ ] Error handling works\n\n### Integration Testing\n- [ ] Works in practice questions\n- [ ] Works in question review\n- [ ] Mobile responsive\n- [ ] Keyboard navigation\n- [ ] Screen reader compatible\n\n## Deployment Notes\n\n1. **Database**: Ensure error_reports table exists\n2. **Permissions**: API route requires authentication\n3. **Rate Limiting**: Monitor for abuse patterns\n4. **Admin Access**: Restrict admin pages appropriately\n5. **Monitoring**: Set up alerts for high report volumes\n\nThe error reporting system is now ready for integration into practice questions throughout the Ember Ascent platform.\n